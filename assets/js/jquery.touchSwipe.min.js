/*
 * jGestures: a jQuery plugin for gesture events
 * http://jgestures.codeplex.com/
 *
 * Copyright (c) 2010-2013 Neue Digitale / Razorfish GmbH
 *
 * Released under the MIT license
 *
 */
(function(a){a.jGestures={};a.jGestures.defaults={};a.jGestures.defaults.jGestures=a.extend({},a.jGestures.defaults,{thresholdShake:{requiredShakes:10,freezeShakes:100,frontback:true,leftright:true,updown:true},thresholdPinchOpen:0.05,thresholdPinchClose:0.05,thresholdSwipe:{velocity:0.5,direction:"all"},thresholdTap:{maxDuration:500,maxDistance:5,minFingers:1,maxFingers:1,waitForNext:500,doubleTap:false,tripleTap:false},thresholdMove:{minLastPos:10,minDistance:15},thresholdRotate:15});a.jGestures.events={PINCHOPEN:"pinchopen",PINCHCLOSE:"pinchclose",SHAKE:"shake",SWIPEONE:"swipeone",SWIPETWO:"swipetwo",SWIPETHREE:"swipethree",SWIPEFOUR:"swipefour",SWIPEUP:"swipeup",SWIPEDOWN:"swipedown",SWIPELEFT:"swipeleft",SWIPERIGHT:"swiperight",TAPONE:"tapone",TAPTWO:"taptwo",TAPTHREE:"tapthree",TAPFOUR:"tapfour",LONGPRESS:"longpress",ORIENTATIONCHANGE:"orientationchange",TOUCHSTART:"touchstart",TOUCHEND:"touchend",MOVE:"move",MOVESTART:"movestart",MOVEEND:"moveend",ROTATE:"rotate"};(function(b){var c=a.jGestures.defaults.jGestures;a.each({pinchopen:a.jGestures.events.PINCHOPEN,pinchclose:a.jGestures.events.PINCHCLOSE,shake:a.jGestures.events.SHAKE,swipeone:a.jGestures.events.SWIPEONE,swipetwo:a.jGestures.events.SWIPETWO,swipethree:a.jGestures.events.SWIPETHREE,swipefour:a.jGestures.events.SWIPEFOUR,swipeup:a.jGestures.events.SWIPEUP,swipedown:a.jGestures.events.SWIPEDOWN,swipeleft:a.jGestures.events.SWIPELEFT,swiperight:a.jGestures.events.SWIPERIGHT,tapone:a.jGestures.events.TAPONE,taptwo:a.jGestures.events.TAPTWO,tapthree:a.jGestures.events.TAPTHREE,tapfour:a.jGestures.events.TAPFOUR,longpress:a.jGestures.events.LONGPRESS,orientationchange:a.jGestures.events.ORIENTATIONCHANGE,touchstart:a.jGestures.events.TOUCHSTART,touchend:a.jGestures.events.TOUCHEND,move:a.jGestures.events.MOVE,movestart:a.jGestures.events.MOVESTART,moveend:a.jGestures.events.MOVEEND,rotate:a.jGestures.events.ROTATE},function(d,e){a.fn[d]=function(f,g){if(g){this.bind(e,f,g)}else{this.bind(e,f)}return this}});b.prototype.jGestures=c;b.prototype.jGestures.events=a.jGestures.events})(a.Event);a.each({touchstart:"touchstart",touchend:"touchend",touchmove:"touchmove"},function(d,e){a.event.fix=function(f){var g=a.event.special[d].original;if(f.type===e&&g){f=g(f)}var h=f.originalEvent;f.touches=h.touches;f.changedTouches=h.changedTouches;f.targetTouches=h.targetTouches;f.multi=false;if(f.touches.length>1){f.multi=true}return f}});a.event.special.pinchopen={setup:function(){a(this).bind("touchstart",a.event.special.pinchopen.handler)},teardown:function(){a(this).unbind("touchstart",a.event.special.pinchopen.handler)},handler:function(d){d.preventDefault();var e=this;var f=d.touches;var g=function(i){var h=d.touches;if(h.length!==2){return}var j=Math.sqrt(Math.pow(h[0].pageX-h[1].pageX,2)+Math.pow(h[0].pageY-h[1].pageY,2));var k=a(e).jGestures().thresholdPinchOpen;if(i.startdistance-j<k*-1){var l=a.Event(a.jGestures.events.PINCHOPEN);l.startdistance=i.startdistance;l.currdistance=j;l.delta=Math.abs(i.startdistance-j);a(e).trigger(l);a(e).unbind("touchmove",g)}return l};if(d.touches.length!==2){return}var h=Math.sqrt(Math.pow(f[0].pageX-f[1].pageX,2)+Math.pow(f[0].pageY-f[1].pageY,2));var b={startdistance:h};a(this).bind("touchmove",b,g);return h}};a.event.special.pinchclose={setup:function(){a(this).bind("touchstart",a.event.special.pinchclose.handler)},teardown:function(){a(this).unbind("touchstart",a.event.special.pinchclose.handler)},handler:function(d){d.preventDefault();var e=this;var f=d.touches;var g=function(i){var h=d.touches;if(h.length!==2){return}var j=Math.sqrt(Math.pow(h[0].pageX-h[1].pageX,2)+Math.pow(h[0].pageY-h[1].pageY,2));var k=a(e).jGestures().thresholdPinchClose;if(i.startdistance-j>k){var l=a.Event(a.jGestures.events.PINCHCLOSE);l.startdistance=i.startdistance;l.currdistance=j;l.delta=Math.abs(i.startdistance-j);a(e).trigger(l);a(e).unbind("touchmove",g)}return l};if(d.touches.length!==2){return}var h=Math.sqrt(Math.pow(f[0].pageX-f[1].pageX,2)+Math.pow(f[0].pageY-f[1].pageY,2));var b={startdistance:h};a(this).bind("touchmove",b,g);return h}};a.event.special.rotate={setup:function(){a(this).bind("touchstart",a.event.special.rotate.handler)},teardown:function(){a(this).unbind("touchstart",a.event.special.rotate.handler)},handler:function(b){b.preventDefault();var c=this;var d=function(h){var g=b.touches;if(g.length!==2){return}var f=Math.atan2(g[0].clientY-g[1].clientY,g[0].clientX-g[1].clientX)*180/Math.PI;if(Math.abs(h.startarrow-f)>a(c).jGestures().thresholdRotate){var e=a.Event(a.jGestures.events.ROTATE);e.startarrow=h.startarrow;e.currarrow=f;e.delta=Math.abs(h.startarrow-f);if(h.startarrow>f){e.direction="left"}else{e.direction="right"}a(c).trigger(e);a(c).unbind("touchmove",d)}return e};var e=b.touches;if(e.length!==2){return}var f=Math.atan2(e[0].clientY-e[1].clientY,e[0].clientX-e[1].clientX)*180/Math.PI;var g={startarrow:f};a(this).bind("touchmove",g,d);return f}};a.event.special.swipeone={setup:function(){a(this).bind("touchstart",a.event.special.swipeone.handler)},teardown:function(){a(this).unbind("touchstart",a.event.special.swipeone.handler)},handler:function(d){d.preventDefault();var e=this;var f=d.touches;var g=function(m){var l=d.touches;var k=a(e).jGestures().thresholdSwipe;var j=m.o.x-l[0].pageX;var i=m.o.y-l[0].pageY;var h=new Date().getTime()-m.o.t;if(h<k.velocity){var n=a.Event(a.jGestures.events.SWIPEONE);n.description=m.description;n.description.speed=Math.sqrt(j*j+i*i)/h;if(Math.abs(j)>Math.abs(i)){if(j>0){if(k.direction==="all"||k.direction==="left"){n.type=a.jGestures.events.SWIPELEFT;a(e).trigger(n)}}else{if(k.direction==="all"||k.direction==="right"){n.type=a.jGestures.events.SWIPERIGHT;a(e).trigger(n)}}}else{if(i>0){if(k.direction==="all"||k.direction==="up"){n.type=a.jGestures.events.SWIPEUP;a(e).trigger(n)}}else{if(k.direction==="all"||k.direction==="down"){n.type=a.jGestures.events.SWIPEDOWN;a(e).trigger(n)}}}}a(e).unbind("touchmove",g);return n};if(d.touches.length!==1){return}var h={o:{x:f[0].pageX,y:f[0].pageY,t:new Date().getTime()},description:{startPoint:{x:f[0].pageX,y:f[0].pageY},endPoint:{x:f[0].pageX,y:f[0].pageY},finger:d.touches.length,delta:[{x:0,y:0}],duration:0}};a(this).bind("touchmove",h,g);return h}};a.event.special.swipetwo={setup:function(){a(this).bind("touchstart",a.event.special.swipetwo.handler)},teardown:function(){a(this).unbind("touchstart",a.event.special.swipetwo.handler)},handler:function(d){d.preventDefault();var e=this;var f=d.touches;var g=function(m){var l=d.touches;var k=a(e).jGestures().thresholdSwipe;var j=m.o.x-l[0].pageX;var i=m.o.y-l[0].pageY;var h=new Date().getTime()-m.o.t;if(h<k.velocity){var n=a.Event(a.jGestures.events.SWIPETWO);n.description=m.description;n.description.speed=Math.sqrt(j*j+i*i)/h;if(Math.abs(j)>Math.abs(i)){if(j>0){if(k.direction==="all"||k.direction==="left"){n.type=a.jGestures.events.SWIPELEFT;a(e).trigger(n)}}else{if(k.direction==="all"||k.direction==="right"){n.type=a.jGestures.events.SWIPERIGHT;a(e).trigger(n)}}}else{if(i>0){if(k.direction==="all"||k.direction==="up"){n.type=a.jGestures.events.SWIPEUP;a(e).trigger(n)}}else{if(k.direction==="all"||k.direction==="down"){n.type=a.jGestures.events.SWIPEDOWN;a(e).trigger(n)}}}}a(e).unbind("touchmove",g);return n};if(d.touches.length!==2){return}var h={o:{x:f[0].pageX,y:f[0].pageY,t:new Date().getTime()},description:{startPoint:{x:f[0].pageX,y:f[0].pageY},endPoint:{x:f[0].pageX,y:f[0].pageY},finger:d.touches.length,delta:[{x:0,y:0}],duration:0}};a(this).bind("touchmove",h,g);return h}};a.event.special.swipethree={setup:function(){a(this).bind("touchstart",a.event.special.swipethree.handler)},teardown:function(){a(this).unbind("touchstart",a.event.special.swipethree.handler)},handler:function(d){d.preventDefault();var e=this;var f=d.touches;var g=function(m){var l=d.touches;var k=a(e).jGestures().thresholdSwipe;var j=m.o.x-l[0].pageX;var i=m.o.y-l[0].pageY;var h=new Date().getTime()-m.o.t;if(h<k.velocity){var n=a.Event(a.jGestures.events.SWIPETHREE);n.description=m.description;n.description.speed=Math.sqrt(j*j+i*i)/h;if(Math.abs(j)>Math.abs(i)){if(j>0){if(k.direction==="all"||k.direction==="left"){n.type=a.jGestures.events.SWIPELEFT;a(e).trigger(n)}}else{if(k.direction==="all"||k.direction==="right"){n.type=a.jGestures.events.SWIPERIGHT;a(e).trigger(n)}}}else{if(i>0){if(k.direction==="all"||k.direction==="up"){n.type=a.jGestures.events.SWIPEUP;a(e).trigger(n)}}else{if(k.direction==="all"||k.direction==="down"){n.type=a.jGestures.events.SWIPEDOWN;a(e).trigger(n)}}}}a(e).unbind("touchmove",g);return n};if(d.touches.length!==3){return}var h={o:{x:f[0].pageX,y:f[0].pageY,t:new Date().getTime()},description:{startPoint:{x:f[0].pageX,y:f[0].pageY},endPoint:{x:f[0].pageX,y:f[0].pageY},finger:d.touches.length,delta:[{x:0,y:0}],duration:0}};a(this).bind("touchmove",h,g);return h}};a.event.special.swipefour={setup:function(){a(this).bind("touchstart",a.event.special.swipefour.handler)},teardown:function(){a(this).unbind("touchstart",a.event.special.swipefour.handler)},handler:function(d){d.preventDefault();var e=this;var f=d.touches;var g=function(m){var l=d.touches;var k=a(e).jGestures().thresholdSwipe;var j=m.o.x-l[0].pageX;var i=m.o.y-l[0].pageY;var h=new Date().getTime()-m.o.t;if(h<k.velocity){var n=a.Event(a.jGestures.events.SWIPEFOUR);n.description=m.description;n.description.speed=Math.sqrt(j*j+i*i)/h;if(Math.abs(j)>Math.abs(i)){if(j>0){if(k.direction==="all"||k.direction==="left"){n.type=a.jGestures.events.SWIPELEFT;a(e).trigger(n)}}else{if(k.direction==="all"||k.direction==="right"){n.type=a.jGestures.events.SWIPERIGHT;a(e).trigger(n)}}}else{if(i>0){if(k.direction==="all"||k.direction==="up"){n.type=a.jGestures.events.SWIPEUP;a(e).trigger(n)}}else{if(k.direction==="all"||k.direction==="down"){n.type=a.jGestures.events.SWIPEDOWN;a(e).trigger(n)}}}}a(e).unbind("touchmove",g);return n};if(d.touches.length!==4){return}var h={o:{x:f[0].pageX,y:f[0].pageY,t:new Date().getTime()},description:{startPoint:{x:f[0].pageX,y:f[0].pageY},endPoint:{x:f[0].pageX,y:f[0].pageY},finger:d.touches.length,delta:[{x:0,y:0}],duration:0}};a(this).bind("touchmove",h,g);return h}};a.event.special.tapone={setup:function(){a(this).bind("touchstart",a.event.special.tapone.handler)},teardown:function(){a(this).unbind("touchstart",a.event.special.tapone.handler)},handler:function(d){d.preventDefault();var e=this;var f=d.touches;var g=a(e).jGestures().thresholdTap;var h=function(k){var j=new Date().getTime()-k.o.t;var i=Math.abs(k.o.x-d.changedTouches[0].pageX);var l=Math.abs(k.o.y-d.changedTouches[0].pageY);if(j<g.maxDuration&&i<g.maxDistance&&l<g.maxDistance){var m=a.Event(a.jGestures.events.TAPONE);m.description=k.description;m.description.duration=j;m.description.toch=d.touches;a(e).trigger(m)}a(e).unbind("touchend",h);return m};if(d.touches.length!==g.minFingers||d.touches.length>g.maxFingers){return}var b={o:{x:f[0].pageX,y:f[0].pageY,t:new Date().getTime()},description:{startPoint:{x:f[0].pageX,y:f[0].pageY},endPoint:{x:d.changedTouches[0].pageX,y:d.changedTouches[0].pageY},finger:d.touches.length,delta:[{x:0,y:0}],duration:0}};a(this).bind("touchend",b,h);return b}};a.event.special.taptwo={setup:function(){a(this).bind("touchstart",a.event.special.taptwo.handler)},teardown:function(){a(this).unbind("touchstart",a.event.special.taptwo.handler)},handler:function(d){d.preventDefault();var e=this;var f=d.touches;var g=a(e).jGestures().thresholdTap;var h=function(k){var j=new Date().getTime()-k.o.t;var i=Math.abs(k.o.x-d.changedTouches[0].pageX);var l=Math.abs(k.o.y-d.changedTouches[0].pageY);if(j<g.maxDuration&&i<g.maxDistance&&l<g.maxDistance){var m=a.Event(a.jGestures.events.TAPTWO);m.description=k.description;m.description.duration=j;m.description.toch=d.touches;a(e).trigger(m)}a(e).unbind("touchend",h);return m};if(d.touches.length!==2){return}var b={o:{x:f[0].pageX,y:f[0].pageY,t:new Date().getTime()},description:{startPoint:{x:f[0].pageX,y:f[0].pageY},endPoint:{x:d.changedTouches[0].pageX,y:d.changedTouches[0].pageY},finger:d.touches.length,delta:[{x:0,y:0}],duration:0}};a(this).bind("touchend",b,h);return b}};a.event.special.tapthree={setup:function(){a(this).bind("touchstart",a.event.special.tapthree.handler)},teardown:function(){a(this).unbind("touchstart",a.event.special.tapthree.handler)},handler:function(d){d.preventDefault();var e=this;var f=d.touches;var g=a(e).jGestures().thresholdTap;var h=function(k){var j=new Date().getTime()-k.o.t;var i=Math.abs(k.o.x-d.changedTouches[0].pageX);var l=Math.abs(k.o.y-d.changedTouches[0].pageY);if(j<g.maxDuration&&i<g.maxDistance&&l<g.maxDistance){var m=a.Event(a.jGestures.events.TAPTHREE);m.description=k.description;m.description.duration=j;m.description.toch=d.touches;a(e).trigger(m)}a(e).unbind("touchend",h);return m};if(d.touches.length!==3){return}var b={o:{x:f[0].pageX,y:f[0].pageY,t:new Date().getTime()},description:{startPoint:{x:f[0].pageX,y:f[0].pageY},endPoint:{x:d.changedTouches[0].pageX,y:d.changedTouches[0].pageY},finger:d.touches.length,delta:[{x:0,y:0}],duration:0}};a(this).bind("touchend",b,h);return b}};a.event.special.tapfour={setup:function(){a(this).bind("touchstart",a.event.special.tapfour.handler)},teardown:function(){a(this).unbind("touchstart",a.event.special.tapfour.handler)},handler:function(d){d.preventDefault();var e=this;var f=d.touches;var g=a(e).jGestures().thresholdTap;var h=function(k){var j=new Date().getTime()-k.o.t;var i=Math.abs(k.o.x-d.changedTouches[0].pageX);var l=Math.abs(k.o.y-d.changedTouches[0].pageY);if(j<g.maxDuration&&i<g.maxDistance&&l<g.maxDistance){var m=a.Event(a.jGestures.events.TAPFOUR);m.description=k.description;m.description.duration=j;m.description.toch=d.touches;a(e).trigger(m)}a(e).unbind("touchend",h);return m};if(d.touches.length!==4){return}var b={o:{x:f[0].pageX,y:f[0].pageY,t:new Date().getTime()},description:{startPoint:{x:f[0].pageX,y:f[0].pageY},endPoint:{x:d.changedTouches[0].pageX,y:d.changedTouches[0].pageY},finger:d.touches.length,delta:[{x:0,y:0}],duration:0}};a(this).bind("touchend",b,h);return b}};a.event.special.longpress={setup:function(){a(this).bind("touchstart",a.event.special.longpress.handler);a(this).bind("touchend",function(){clearTimeout(a(this).data("longpressTimeout"))})},teardown:function(){a(this).unbind("touchstart",a.event.special.longpress.handler)},handler:function(c){c.preventDefault();var d=this;var e=c.touches;var b={o:{x:e[0].pageX,y:e[0].pageY,t:new Date().getTime()},timer:null};a(d).data("longpressTimeout",setTimeout(function(){var f=a.Event(a.jGestures.events.LONGPRESS);f.description=b.description;f.description.duration=new Date().getTime()-b.o.t;a(d).trigger(f)},500));b.description={startPoint:{x:e[0].pageX,y:e[0].pageY},endPoint:{x:c.changedTouches[0].pageX,y:c.changedTouches[0].pageY},finger:c.touches.length,delta:[{x:0,y:0}],duration:0};return b}};a.event.special.movestart={setup:function(b,c){a(this).bind("touchstart",a.event.special.movestart.handler)},teardown:function(b){a(this).unbind("touchstart",a.event.special.movestart.handler)},handler:function(d){d.preventDefault();var e=this;var f=d.touches;var g=function(i){var h=d.touches;var j=a.Event(a.jGestures.events.MOVE);j.description=i.description;j.description.last=i.o;j.description.delta={x:h[0].pageX-i.o.x,y:h[0].pageY-i.o.y};if(Math.abs(j.description.delta.x)>a(e).jGestures().thresholdMove.minDistance||Math.abs(j.description.delta.y)>a(e).jGestures().thresholdMove.minDistance){var k=a.Event(a.jGestures.events.MOVESTART);k.description=j.description;a(e).trigger(k);a(e).unbind("touchmove",g)}return k};if(d.touches.length!==1){return}var h={o:{x:f[0].pageX,y:f[0].pageY,t:new Date().getTime()},description:{startPoint:{x:f[0].pageX,y:f[0].pageY},endPoint:{x:d.changedTouches[0].pageX,y:d.changedTouches[0].pageY},finger:d.touches.length,delta:[{x:0,y:0}],duration:0}};a(this).bind("touchmove",h,g);return h}};a.event.special.move={setup:function(){a(this).bind("movestart",a.event.special.move.handler)},teardown:function(){a(this).unbind("movestart",a.event.special.move.handler)},handler:function(d){d.preventDefault();var e=this;var f=d.touches;var g=function(i){var h=d.touches;var j=a.Event(a.jGestures.events.MOVE);j.description=i.description;j.description.last=i.o;j.description.delta={x:h[0].pageX-i.o.x,y:h[0].pageY-i.o.y};a(e).trigger(j);i.o.x=h[0].pageX;i.o.y=h[0].pageY;return j};a(this).bind("touchmove",d,g);a(this).bind("touchend",d,function(i){var h=a.Event(a.jGestures.events.MOVEEND);h.description=i.description;a(e).trigger(h);a(e).unbind("touchmove",g);a(e).unbind("touchend",arguments.callee)})}};a.event.special.orientationchange={setup:function(){a(window).bind("orientationchange",a.event.special.orientationchange.handler)},teardown:function(){a(window).unbind("orientationchange",a.event.special.orientationchange.handler)},handler:function(c){c.preventDefault();var d=this;var b=a.Event(a.jGestures.events.ORIENTATIONCHANGE);switch(window.orientation){case 0:b.orientation="portrait";break;case 90:b.orientation="landscape";break;case -90:b.orientation="landscape";break;case 180:b.orientation="portrait";break;default:b.orientation="undefined"}a(d).trigger(b);return b}};a.event.special.shake={setup:function(){a(window).bind("devicemotion",a.event.special.shake.handler)},teardown:function(){a(window).unbind("devicemotion",a.event.special.shake.handler)},handler:function(g){var h=this;var i=a(h).jGestures().thresholdShake;var j=g.originalEvent;var k={x:j.accelerationIncludingGravity.x,y:j.accelerationIncludingGravity.y,z:j.accelerationIncludingGravity.z,lastX:a(h).data("lastX")||0,lastY:a(h).data("lastY")||0,lastZ:a(h).data("lastZ")||0,shakeCount:a(h).data("shakeCount")||0,freezeCount:a(h).data("freezeCount")||0};if(k.freezeCount>0){a(h).data("freezeCount",--k.freezeCount);return}if((Math.abs(k.x-k.lastX)>1&&i.leftright)||(Math.abs(k.y-k.lastY)>1&&i.frontback)||(Math.abs(k.z-k.lastZ+9.81)>2&&i.updown)){if(++k.shakeCount>i.requiredShakes){var f=a.Event(a.jGestures.events.SHAKE);f.description=k;a(h).trigger(f);k.shakeCount=0;k.freezeCount=i.freezeShakes}a(h).data("shakeCount",k.shakeCount)}else{if(k.shakeCount>0){k.shakeCount--}a(h).data("shakeCount",k.shakeCount)}a(h).data("lastX",k.x);a(h).data("lastY",k.y);a(h).data("lastZ",k.z);a(h).data("freezeCount",k.freezeCount)}}})(jQuery);
